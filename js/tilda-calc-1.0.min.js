function tcalc__init(e,t){var c,a,r,l,n,o,s,i=document.querySelector("#rec"+e);!i||(c=i.querySelector('[data-input-lid="'+t+'"]'))&&(r=(a=(a=c.querySelector(".t-calc"))||i.querySelector(".t-calc")).getAttribute("data-calc-expr"),l=i.querySelectorAll(".t-select, .t-radio, .t-checkbox, .t-img-select"),n=i.querySelectorAll(".t-inputquantity__btn"),o=i.querySelectorAll(".t-input"),t=i.querySelectorAll(".t-range"),r?(s=tcalc__getParseExpression(r=r.replace(/\s/g,"").replace(/,/g,".")),tcalc__cashOperandsFieldsEls(i,s),tcalc__cutAndHideFieldsValues(s),!0!==s.error?(Array.prototype.forEach.call(o,function(t){Array.prototype.forEach.call(["keyup","keydown","input"],function(e){t.addEventListener(e,function(){setTimeout(function(){tcalc__changeVal(i,c,a,tcalc__calcValue(s))},1)})})}),Array.prototype.forEach.call(l,function(e){e.addEventListener("change",function(){tcalc__changeVal(i,c,a,tcalc__calcValue(s))})}),Array.prototype.forEach.call(n,function(e){e.addEventListener("click",function(){tcalc__changeVal(i,c,a,tcalc__calcValue(s))})}),Array.prototype.forEach.call(t,function(t){Array.prototype.forEach.call(["click","input","change"],function(e){t.addEventListener(e,function(){tcalc__changeVal(i,c,a,tcalc__calcValue(s))})})}),tcalc__changeVal(i,c,a,tcalc__calcValue(s))):console.log("Please check math expression or input names(especially spaces) in rec"+e)):console.log("Error: formula field is empty in rec"+e))}function tcalc__getParseExpression(e){var t=e.split(""),c=[],a=[],r=0,l=!0;c[r]=Object.create(null),c[r].str="";for(var n=0;n<t.length;n++)"("!==t[n]&&")"!==t[n]&&(l="+"!==t[n]&&"-"!==t[n]&&"*"!==t[n]&&"/"!==t[n]||l?(c[r].str+=t[n],!1):(a[r]=t[n],c[++r]=Object.create(null),!(c[r].str="")));return{str:e,operands:c,operators:a}}function tcalc__cashOperandsFieldsEls(e,t){for(var c=0;c<t.operands.length;c++){var a=t.operands[c].str;if(isNaN(a)){var r=e.querySelectorAll('[name="'+a+'"]');if(!r)return console.log("Error: incorrect operand: "+a),void(t.error=!0);t.operands[c].type="variable",t.operands[c].field=r}else t.operands[c].type="number",t.operands[c].value=+t.operands[c].str}}function tcalc__cutAndHideFieldsValues(e){for(var t=0;t<e.operands.length;t++){var c,a,r,l=e.operands[t];"variable"===l.type&&((a=(c=l.field)[0]).classList.contains("t-select")&&(l=a.querySelectorAll("option"),Array.prototype.forEach.call(l,function(e){var t=e.value;t&&((t=t.split("=")).length<2||(e.value=t[0],e.innerHTML=t[0],e.setAttribute("data-calc-value",t[1])))})),(a.classList.contains("t-checkboxes__hiddeninput")||a.classList.contains("t-checkbox")||a.classList.contains("t-radio"))&&(r=a.classList.contains("t-checkboxes__hiddeninput")?a.closest(".t-input-block").querySelectorAll(".t-checkbox"):c,Array.prototype.forEach.call(r,function(e){var t=e.classList.contains("t-radio")?e.closest(".t-radio__control"):e.closest(".t-checkbox__control"),c=t.querySelector(".t-checkbox__labeltext"),a=t.textContent;c&&(a=c.textContent),a&&((a=a.split("=")).length<2||(e.closest(".t-input-group_rd")&&e.setAttribute("value",a[0]),e.setAttribute("data-calc-value",a[1]),c?c.textContent=a[0]:(t=t.childNodes)[t.length-1].textContent=a[0]))})),(a.classList.contains("t-img-select__hiddeninput")||a.classList.contains("t-img-select"))&&(r=a.classList.contains("t-img-select__hiddeninput")?a.closest(".t-input-block").querySelectorAll(".t-img-select"):c,Array.prototype.forEach.call(r,function(e){var t=e.closest(".t-img-select__control"),c=t.querySelector(".t-img-select__text"),a=c.textContent;a&&((a=a.split("=")).length<2||(a[0]?e.setAttribute("value",a[0]):e.setAttribute("value",t.querySelector(".t-img-select__indicator").getAttribute("data-original")),e.setAttribute("data-calc-value",a[1]),c.textContent=a[0]))})))}}function tcalc__changeVal(e,t,c,a){var r=(r=t.querySelector(".t-calc__hiddeninput"))||e.querySelector(".t-calc__hiddeninput");if(isNaN(a)?(c.innerHTML=0,r.value=0):(c.innerHTML=a,r.value=a),t.querySelector('input[type="hidden"][class^="t-calc__hidden__prod"]')){var l=t.closest(".t-form__inputsbox"),c=t.querySelector(".t-calc__hidden__prod_img"),r=t.querySelector(".t-calc__hidden__prod_title"),t="",n="";c&&(t=c.value||""),r&&(n=r.value||"NoName");var o,s={str:n,variables:[]},i=s.str.match(/[A-z0-9_]+/gi);for(f in i){var u=l.querySelectorAll('[type="radio"][name="'+i[f]+'"]:checked');1===u.length?s.variables.push({str:i[f],value:u[0].value}):1===(u=l.querySelectorAll('[name="'+i[f]+'"]')).length&&s.variables.push({str:i[f],value:u[0].value})}for(o in s.variables){var _=s.variables[o].str,p=s.variables[o].value;if(0<p.indexOf("=")){for(var d=p.split(";"),h=[],f=0;f<d.length;f++){var v=d[f];0<v.indexOf("=")?h.push(v.split("=")[0]):h.push(v)}p=h.join(";")}_&&p&&(n=n.replace(new RegExp(_),p))}r=l.querySelector('[class$="-form__submit"] button.t-submit'),a="#order:"+n+"="+a;t&&(a+=":::image="+t),r.setAttribute("href",a),r.setAttribute("type","")}}function tcalc__calcValue(e){tcalc__getFieldsValues(e);for(var t=e.str,c=0;c<e.operands.length;c++)var a=(a=e.operands[c].value)<0?"(0"+a+")":a,t=t.replace(e.operands[c].str,a);try{var r=tcalc__evaluate(tcalc__parse(t))}catch(e){console.log("Something went wrong in form calculator! Please, connect support or developers")}return Math.round(10*r)/10}function tcalc__getFieldsValues(e){for(var t,c,a,r,l,n,o,s=0;s<e.operands.length;s++)"variable"==e.operands[s].type&&(t=(n=(r=e.operands[s].field)[0]).classList.contains("t-img-select")&&"radio"===n.getAttribute("type"),c=n.classList.contains("t-img-select__hiddeninput"),(n.classList.contains("t-input")||n.classList.contains("t-range")||n.classList.contains("t-calc__hiddeninput"))&&(l=n.value,tcalc__getFieldsValues__saveToArr(e.operands[s],l)),n.classList.contains("t-select")&&(l=0,(a=n.querySelector("option:checked"))&&(l=a.getAttribute("data-calc-value")),tcalc__getFieldsValues__saveToArr(e.operands[s],l)),(n.classList.contains("t-radio")||n.classList.contains("t-checkbox")||t)&&((r=Array.prototype.filter.call(r,function(e){if(e.checked)return e}))[l=0]&&(l=r[0].getAttribute("data-calc-value")),tcalc__getFieldsValues__saveToArr(e.operands[s],l)),(n.classList.contains("t-checkboxes__hiddeninput")||c)&&(n=n.closest(".t-input-block"),n=c?n.querySelectorAll(".t-img-select:checked"):n.querySelectorAll(".t-checkbox:checked"),o=0,Array.prototype.forEach.call(n,function(e){e=(e=e.getAttribute("data-calc-value"))?e.replace(/[^0-9.]/g,""):0;o+=parseFloat(e)}),tcalc__getFieldsValues__saveToArr(e.operands[s],o.toString())))}function tcalc__getFieldsValues__saveToArr(e,t){var c=parseInt(t,10)<0;t=t?t.replace(/,/g,".").replace(/[^0-9.]/g,""):"",e.value=t?parseFloat(t):0,c&&(e.value=-e.value)}function tcalc__evaluate(e){switch(e.type){case"number":return parseFloat(e.value);case"+":return tcalc__evaluate(e.left)+tcalc__evaluate(e.right);case"-":return tcalc__evaluate(e.left)-tcalc__evaluate(e.right);case"*":return tcalc__evaluate(e.left)*tcalc__evaluate(e.right);case"/":return tcalc__evaluate(e.left)/tcalc__evaluate(e.right)}}function tcalc__parse(e){var t={tokens:tcalc__tokenize(e),position:0},e=tcalc__parseExpr(t);if(t.position!==t.tokens.length)throw new SyntaxError("unexpected '"+tcalc__peek(t)+"'");return e}function tcalc__tokenize(e){for(var t,c=[],a=/\s*([A-Za-z]+|[0-9.]+|\S)\s*/g;t=a.exec(e);)c.push(t[1]);return c}function tcalc__parseExpr(e){for(var t=tcalc__parseMulExpr(e),c=tcalc__peek(e);"+"===c||"-"===c;){tcalc__consume(e);t={type:c,left:t,right:tcalc__parseMulExpr(e)},c=tcalc__peek(e)}return t}function tcalc__parseMulExpr(e){for(var t=tcalc__parsePrimaryExpr(e),c=tcalc__peek(e);"*"===c||"/"===c;){tcalc__consume(e);t={type:c,left:t,right:tcalc__parsePrimaryExpr(e)},c=tcalc__peek(e)}return t}function tcalc__parsePrimaryExpr(e){var t=tcalc__peek(e);if(tcalc__isNumber(t))return tcalc__consume(e),{type:"number",value:t};if(tcalc__isName(t))return tcalc__consume(e),{type:"name",id:t};if("("!==t)throw new SyntaxError("expected a number, a variable, or parentheses");tcalc__consume(e);t=tcalc__parseExpr(e);if(")"!==tcalc__peek(e))throw new SyntaxError("expected )");return tcalc__consume(e),t}function tcalc__peek(e){return e.tokens[e.position]}function tcalc__consume(e){e.position++}function tcalc__isName(e){return e&&e.match(/^[A-Za-z]+$/)}function tcalc__isNumber(e){return e&&e.match(/^[0-9.]+$/)}Array.prototype.some||(Array.prototype.some=function(e){"use strict";if(null==this)throw new TypeError("Array.prototype.some called on null or undefined");if("function"!=typeof e)throw new TypeError;for(var t=Object(this),c=t.length>>>0,a=2<=arguments.length?arguments[1]:void 0,r=0;r<c;r++)if(r in t&&e.call(a,t[r],r,t))return!0;return!1}),function(e){var t=e.matches||e.matchesSelector||e.webkitMatchesSelector||e.mozMatchesSelector||e.msMatchesSelector||e.oMatchesSelector;e.matches=e.matchesSelector=t||function(e){var t=document.querySelectorAll(e),c=this;return Array.prototype.some.call(t,function(e){return e===c})}}(Element.prototype),Element.prototype.closest||(Element.prototype.closest=function(e){for(var t=this;t&&1===t.nodeType;){if(Element.prototype.matches.call(t,e))return t;t=t.parentElement||t.parentNode}return null});